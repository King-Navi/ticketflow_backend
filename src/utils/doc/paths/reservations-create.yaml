post:
  tags: [Reservations]
  operationId: createReservation
  summary: Crea una reserva de un asiento de evento
  description: >
    Crea una reserva (hold) para un `event_seat` de un evento que esté en venta.
    Valida que el evento exista y esté `on_sale`, que el asiento pertenezca al evento,
    que no haya una reserva activa/no expirada y que no exista un ticket bloqueante.
    La expiración real se limita a un máximo de 15 minutos desde la creación,
    aunque el cliente envíe un valor mayor.
  security:
    - bearerAuth: []
  requestBody:
    required: true
    content:
      application/json:
        schema:
          type: object
          additionalProperties: false
          required:
            - event_id
            - event_seat_id
          properties:
            event_id:
              type: integer
              minimum: 1
              example: 42
            event_seat_id:
              type: integer
              minimum: 1
              example: 555
            expiration_at:
              type: string
              format: date-time
              description: >
                Opcional. Si se envía más de 15 minutos en el futuro,
                el servidor la recortará a 15 minutos desde ahora.
              example: "2025-11-06T15:30:00Z"
  responses:
    "201":
      description: Reserva creada y asiento marcado como reservado.
      content:
        application/json:
          schema:
            type: object
            required: [ok, message, reservation]
            properties:
              ok:
                type: boolean
                example: true
              message:
                type: string
                example: "Reservation created and seat marked as reserved."
              reservation:
                type: object
                properties:
                  reservation_id:
                    type: integer
                    example: 901
                  attendee_id:
                    type: integer
                    example: 101
                  event_seat_id:
                    type: integer
                    example: 555
                  status:
                    type: string
                    example: "active"
                  expiration_at:
                    type: string
                    format: date-time
              event:
                type: object
                description: Evento validado (opcional, según lo devuelto por el service).
              eventSeat:
                type: object
                description: Asiento del evento ya actualizado a `reserved`.
    "400":
      description: Petición inválida (faltan campos o formato).
      content:
        application/json:
          schema:
            type: object
            required: [msg]
            properties:
              msg:
                type: string
                example: "event_id is required."
    "404":
      description: Recurso relacionado no encontrado (evento o asiento de evento).
      content:
        application/json:
          schema:
            type: object
            required: [msg]
            properties:
              msg:
                type: string
                example: "Event seat not found."
    "409":
      description: Conflicto de negocio (asiento ya reservado, ticket vendido o asiento no disponible).
      content:
        application/json:
          schema:
            type: object
            required: [msg]
            properties:
              msg:
                type: string
                example: "This seat already has an active reservation."
              meta:
                type: object
                description: Información adicional del conflicto.
          examples:
            seat_reserved:
              value:
                msg: "This seat already has an active reservation."
                meta:
                  reservation_id: 345
                  expires_at: "2025-11-06T15:45:00Z"
            ticket_blocking:
              value:
                msg: "This seat already has a sold/checked-in ticket."
                meta:
                  ticket_id: 777
                  ticket_status_id: 1
            seat_not_available:
              value:
                msg: "This seat is not available for reservation."
                meta:
                  current_status_id: 4
                  allowed_status_id: 1
    "503":
      description: No se pudo conectar a la base de datos.
      content:
        application/json:
          schema:
            type: object
            required: [msg]
            properties:
              msg:
                type: string
                example: "Cannot connect to the database."
    "500":
      description: Error interno no controlado.
      content:
        application/json:
          schema:
            type: object
            required: [msg]
            properties:
              msg:
                type: string
                example: "Error"
              detail:
                type: string
                example: "Unexpected error."
