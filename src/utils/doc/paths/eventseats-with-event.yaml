put:
  tags: [EventSeats]
  operationId: createEventWithInventory
  summary: Create an event and its seat inventory (event_seat)
  description: >
    Creates a new event and clones the selected physical seats into the event-specific inventory
    (`event_seat`) in a single atomic transaction. If any insertion fails, the entire operation is rolled back.
  security:
    - bearerAuth: []
  requestBody:
    required: true
    content:
      application/json:
        schema:
          $ref: "../schemas/eventseats.yaml#/EventWithInventoryCreateRequest"
        examples:
          minimal:
            value:
              event:
                event_name: "Rock Night Tour"
                category: "Concert"
                description: "One-night-only performance."
                event_date: "2025-12-05"
                start_time: "20:00:00"
                end_time: "23:30:00"
                company_id: 7
                event_location_id: 42
              inventory:
                - seat_id: 501
                  base_price: 1500.00
                  status: "available"
                  category_label: "VIP"
                - seat_id: 502
                  base_price: 1500.00
                  status: "available"
                  category_label: "VIP"
                - seat_id: 560
                  base_price: 800.00
                  status: "available"
                  category_label: "General Floor"
  responses:
    "201":
      description: Event and inventory successfully created.
      content:
        application/json:
          schema:
            $ref: "../schemas/eventseats.yaml#/EventWithInventoryCreateResponse"
          examples:
            created:
              value:
                event_id: 1234
                event_location_id: 42
                inventory_created:
                  - event_seat_id: 9001
                    seat_id: 501
                    base_price: 1500.00
                    status: "available"
                  - event_seat_id: 9002
                    seat_id: 502
                    base_price: 1500.00
                    status: "available"
                  - event_seat_id: 9003
                    seat_id: 560
                    base_price: 800.00
                    status: "available"
                counts:
                  requested: 3
                  created: 3

    "400":
      description: Validation error (body invalid or business rule failure).
      content:
        application/json:
          schema:
            $ref: "../schemas/common.yaml#/Error"
          examples:
            joi_invalid:
              value:
                msg: "Invalid request body."
                details:
                  - "\"event.event_date\" must be in YYYY-MM-DD format"
                  - "\"inventory[0].base_price\" must be a number"
            invalid_status:
              value:
                msg: "Invalid seat status: 'foo'."

    "401":
      description: Unauthorized (missing or invalid token).
      content:
        application/json:
          schema:
            $ref: "../schemas/common.yaml#/Error"
          examples:
            unauthorized:
              value: { msg: "Unauthorized" }

    "403":
      description: Forbidden (requires organizer or admin role).
      content:
        application/json:
          schema:
            $ref: "../schemas/common.yaml#/Error"
          examples:
            forbidden:
              value: { msg: "Forbidden" }

    "409":
      description: Conflict (database constraint error, e.g., duplicate (event_id, seat_id) or FK violation).
      content:
        application/json:
          schema:
            $ref: "../schemas/common.yaml#/Error"
          examples:
            conflict:
              value: { msg: "Database error occurred." }

    "503":
      description: Database connection error.
      content:
        application/json:
          schema:
            $ref: "../schemas/common.yaml#/Error"
          examples:
            db_down:
              value: { msg: "Cannot connect to the database." }

    "500":
      description: Unexpected server error.
      content:
        application/json:
          schema:
            $ref: "../schemas/common.yaml#/Error"
          examples:
            server_error:
              value: { msg: "Error" }
